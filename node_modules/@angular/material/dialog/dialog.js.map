{"version":3,"sources":["dialog/dialog.ts"],"names":[],"mappings":"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","file":"dialog.js","sourcesContent":["import {Injector, ComponentRef, Injectable} from '@angular/core';\n\nimport {Overlay, OverlayRef, ComponentType, OverlayState, ComponentPortal} from '../core';\nimport {extendObject} from '../core/util/object-extend';\n\nimport {DialogInjector} from './dialog-injector';\nimport {MdDialogConfig} from './dialog-config';\nimport {MdDialogRef} from './dialog-ref';\nimport {MdDialogContainer} from './dialog-container';\n\n\n// TODO(jelbourn): add support for opening with a TemplateRef\n// TODO(jelbourn): animations\n\n\n\n/**\n * Service to open Material Design modal dialogs.\n */\n@Injectable()\nexport class MdDialog {\n  /** Keeps track of the currently-open dialogs. */\n  private _openDialogs: MdDialogRef<any>[] = [];\n\n  constructor(private _overlay: Overlay, private _injector: Injector) { }\n\n  /**\n   * Opens a modal dialog containing the given component.\n   * @param component Type of the component to load into the load.\n   * @param config Extra configuration options.\n   * @returns Reference to the newly-opened dialog.\n   */\n  open<T>(component: ComponentType<T>, config?: MdDialogConfig): MdDialogRef<T> {\n    config = _applyConfigDefaults(config);\n\n    let overlayRef = this._createOverlay(config);\n    let dialogContainer = this._attachDialogContainer(overlayRef, config);\n    let dialogRef = this._attachDialogContent(component, dialogContainer, overlayRef);\n\n    this._openDialogs.push(dialogRef);\n    dialogRef.afterClosed().subscribe(() => this._removeOpenDialog(dialogRef));\n\n    return dialogRef;\n  }\n\n  /**\n   * Closes all of the currently-open dialogs.\n   */\n  closeAll(): void {\n    let i = this._openDialogs.length;\n\n    while (i--) {\n      // The `_openDialogs` property isn't updated after close until the rxjs subscription\n      // runs on the next microtask, in addition to modifying the array as we're going\n      // through it. We loop through all of them and call close without assuming that\n      // they'll be removed from the list instantaneously.\n      this._openDialogs[i].close();\n    }\n  }\n\n  /**\n   * Creates the overlay into which the dialog will be loaded.\n   * @param dialogConfig The dialog configuration.\n   * @returns A promise resolving to the OverlayRef for the created overlay.\n   */\n  private _createOverlay(dialogConfig: MdDialogConfig): OverlayRef {\n    let overlayState = this._getOverlayState(dialogConfig);\n    return this._overlay.create(overlayState);\n  }\n\n  /**\n   * Attaches an MdDialogContainer to a dialog's already-created overlay.\n   * @param overlay Reference to the dialog's underlying overlay.\n   * @param config The dialog configuration.\n   * @returns A promise resolving to a ComponentRef for the attached container.\n   */\n  private _attachDialogContainer(overlay: OverlayRef, config: MdDialogConfig): MdDialogContainer {\n    let viewContainer = config ? config.viewContainerRef : null;\n    let containerPortal = new ComponentPortal(MdDialogContainer, viewContainer);\n\n    let containerRef: ComponentRef<MdDialogContainer> = overlay.attach(containerPortal);\n    containerRef.instance.dialogConfig = config;\n\n    return containerRef.instance;\n  }\n\n  /**\n   * Attaches the user-provided component to the already-created MdDialogContainer.\n   * @param component The type of component being loaded into the dialog.\n   * @param dialogContainer Reference to the wrapping MdDialogContainer.\n   * @param overlayRef Reference to the overlay in which the dialog resides.\n   * @returns A promise resolving to the MdDialogRef that should be returned to the user.\n   */\n  private _attachDialogContent<T>(\n      component: ComponentType<T>,\n      dialogContainer: MdDialogContainer,\n      overlayRef: OverlayRef): MdDialogRef<T> {\n    // Create a reference to the dialog we're creating in order to give the user a handle\n    // to modify and close it.\n    let dialogRef = <MdDialogRef<T>> new MdDialogRef(overlayRef);\n\n    if (!dialogContainer.dialogConfig.disableClose) {\n      // When the dialog backdrop is clicked, we want to close it.\n      overlayRef.backdropClick().first().subscribe(() => dialogRef.close());\n    }\n\n    // Set the dialogRef to the container so that it can use the ref to close the dialog.\n    dialogContainer.dialogRef = dialogRef;\n\n    // We create an injector specifically for the component we're instantiating so that it can\n    // inject the MdDialogRef. This allows a component loaded inside of a dialog to close itself\n    // and, optionally, to return a value.\n    let dialogInjector = new DialogInjector(dialogRef, this._injector);\n\n    let contentPortal = new ComponentPortal(component, null, dialogInjector);\n\n    let contentRef = dialogContainer.attachComponentPortal(contentPortal);\n    dialogRef.componentInstance = contentRef.instance;\n\n    return dialogRef;\n  }\n\n  /**\n   * Creates an overlay state from a dialog config.\n   * @param dialogConfig The dialog configuration.\n   * @returns The overlay configuration.\n   */\n  private _getOverlayState(dialogConfig: MdDialogConfig): OverlayState {\n    let state = new OverlayState();\n    let strategy = this._overlay.position().global();\n    let position = dialogConfig.position;\n\n    state.hasBackdrop = true;\n    state.positionStrategy = strategy;\n\n    if (position && (position.left || position.right)) {\n      position.left ? strategy.left(position.left) : strategy.right(position.right);\n    } else {\n      strategy.centerHorizontally();\n    }\n\n    if (position && (position.top || position.bottom)) {\n      position.top ? strategy.top(position.top) : strategy.bottom(position.bottom);\n    } else {\n      strategy.centerVertically();\n    }\n\n    strategy.width(dialogConfig.width).height(dialogConfig.height);\n\n    return state;\n  }\n\n  /**\n   * Removes a dialog from the array of open dialogs.\n   * @param dialogRef Dialog to be removed.\n   */\n  private _removeOpenDialog(dialogRef: MdDialogRef<any>) {\n    let index = this._openDialogs.indexOf(dialogRef);\n\n    if (index > -1) {\n      this._openDialogs.splice(index, 1);\n    }\n  }\n}\n\n/**\n * Applies default options to the dialog config.\n * @param dialogConfig Config to be modified.\n * @returns The new configuration object.\n */\nfunction _applyConfigDefaults(dialogConfig: MdDialogConfig): MdDialogConfig {\n  return extendObject(new MdDialogConfig(), dialogConfig);\n}\n\n"]}